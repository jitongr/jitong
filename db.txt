CREATE TABLE IF NOT EXISTS `jt_viewlog` (
  `id` int(11) NOT NULL auto_increment,
  `method` varchar(12) NOT NULL,
  `viewid` int(6) NOT NULL default '0',
  `concept` int(11) NOT NULL default '0',
  `uid` int(10) unsigned NOT NULL default '0',
  `vtime` datetime NOT NULL,
  `text` varchar(360) NOT NULL default '',
  `loginip` char(20) NOT NULL default '',
  PRIMARY KEY  (`id`)
) ENGINE=MyISAM  DEFAULT CHARSET=utf8


CREATE TABLE IF NOT EXISTS `cruboy_concept2` (
  `id` int(11) NOT NULL auto_increment,
  `text` varchar(200) NOT NULL,
  `imgid` int(11) NOT NULL default '0',
  `backimgid` int(11) NOT NULL default '0',
  `url` varchar(200) NOT NULL,
  `info` varchar(255) NOT NULL default '',
  `ctop` int(4) NOT NULL default '0',
  `cleft` int(4) NOT NULL default '0',
  `num_assertions` int(11) NOT NULL default '0',
  `words` int(11) NOT NULL default '0',
  `blogid` int(10) NOT NULL default '0',
  `visible` tinyint(1) NOT NULL default '0',
  sort	tinyint(4)
  
  `style` tinyint(4) NOT NULL default '0',-
  `cruboy` tinyint(3) NOT NULL default '0',-
  `f1` int(11) NOT NULL default '0',
  `f2` int(11) NOT NULL default '0',
  `f3` int(11) NOT NULL default '0',
  `edittime` int(11) NOT NULL default '0',
  `uid` int(10) NOT NULL default '0',
  hn
  PRIMARY KEY  (`id`)
) ENGINE=MyISAM  DEFAULT CHARSET=utf8

CREATE TABLE IF NOT EXISTS `cruboy_assertion2` (
  `id` int(11) NOT NULL auto_increment,
  `relation_id` int(11) NOT NULL default '0',
  `concept1_id` int(11) NOT NULL default '0',
  `concept2_id` int(11) NOT NULL default '0',
  `score` int(11) NOT NULL default '0',
  `atop1` int(4) NOT NULL default '0',
  `aleft1` int(4) NOT NULL default '0',
  `atop2` int(4) NOT NULL default '0',
  `aleft2` int(4) NOT NULL default '0',
  `itop1` int(11) NOT NULL default '0',
  `ileft1` int(11) NOT NULL default '0',
  `itop2` int(11) NOT NULL default '0',
  `ileft2` int(11) NOT NULL default '0',
  `best_frame_id` int(5) NOT NULL default '0',
  `abid` int(10) NOT NULL default '0',
  `seq` int(4) NOT NULL default '0',
  visible	tinyint(1)			
	good	int(10)			
	bad	int(10)			 
	creator	int(11)			
	edittime	int(11)			
	uid	int(10)	
  `edittime` int(11) NOT NULL default '0',
  `uid` int(10) NOT NULL default '0',
  PRIMARY KEY  (`id`),
  KEY `assertions_1ef32bca` (`concept2_id`),
  KEY `assertions_49612959` (`concept1_id`),
  KEY `assertions_b9eab798` (`relation_id`),
  KEY `assertions_a648f606` (`best_frame_id`)
) ENGINE=MyISAM  DEFAULT CHARSET=utf8




UPDATE conceptnet_frame A 
INNER JOIN (SELECT *, COUNT(*) idcount FROM conceptnet_assertion GROUP BY best_frame_id) as B
  ON B.best_frame_id = A.id
SET A.n1 = B.idcount

UPDATE conceptnet_frame A 
INNER JOIN (SELECT *, COUNT(*) idcount FROM cruboy_assertion2 GROUP BY best_frame_id) as B
  ON B.best_frame_id = A.id
SET A.n2 = B.idcount


DROP  `question_yn` ,
DROP  `question1` ,
DROP  `question2` ;
ALTER TABLE  `conceptnet_frame` CHANGE  `text`  `text` VARCHAR( 200 ) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL DEFAULT  ''
update `conceptnet_frame` set `text`=REPLACE(`text`,' ','')
update `conceptnet_frame` set `text`=REPLACE(`text`,'¡£','')

ALTER TABLE  `conceptnet_relation` ADD  `n1` INT NOT NULL DEFAULT  '0'

UPDATE `conceptnet_relation` A 
INNER JOIN (SELECT *, COUNT(*) idcount FROM conceptnet_assertion GROUP BY relation_id) as B
  ON relation_id= A.id
SET A.n1 = B.idcount
ALTER TABLE  `conceptnet_relation` ADD  `n2` INT NOT NULL DEFAULT  '0'

UPDATE `conceptnet_relation` A 
INNER JOIN (SELECT *, COUNT(*) idcount FROM cruboy_assertion2 GROUP BY relation_id) as B
  ON relation_id= A.id
SET A.n2 = B.idcount


ALTER TABLE  `conceptnet_relation` ADD  `nf` INT NOT NULL DEFAULT  '0'

UPDATE `conceptnet_relation` A 
INNER JOIN (SELECT *, COUNT(*) idcount FROM conceptnet_frame GROUP BY relation_id) as B
  ON relation_id= A.id
SET A.nf = B.idcount

CREATE TABLE IF NOT EXISTS `vasslog` (
  `id` int  NOT NULL auto_increment,
  `cpid` int(11) NOT NULL default '0',
  `rid` int(11) NOT NULL default '0',
  `method` varchar(10) NOT NULL default '',
  `edate` datetime NOT NULL,
  `uid` int(11) NOT NULL default '0',
  `content` text NOT NULL,
  `ip` varchar(128) NOT NULL default '',
  `seid` varchar(100) NOT NULL default '',
  PRIMARY KEY  (`id`)
) ENGINE=MyISAM  DEFAULT CHARSET=utf8 

ALTER TABLE  `conceptnet_concept` ADD  `imgsize`  int NOT NULL DEFAULT  '0' AFTER  `imgid`;
UPDATE  `jitongr`.`conceptnet_concept` SET  `imgid` =  '273',
`imgsize` =  '-1' WHERE  `conceptnet_concept`.`id` =12591 LIMIT 1 ;
ALTER TABLE  `conceptnet_concept` DROP  `backimgid`;

ALTER TABLE  `emlog_attachment` ADD  `cnum` TINYINT NOT NULL DEFAULT  '0' AFTER  `blogid`;
ALTER TABLE  `emlog_attachment` ADD  `uid` INT NOT NULL DEFAULT  '0';
ALTER TABLE  `emlog_attachment` CHANGE  `cid`  `cid0` INT( 11 ) NOT NULL DEFAULT  '0';

update  `emlog_attachment` set cnum=1 where aid in (select imgid from `conceptnet_concept` where imgid >0 );
ALTER TABLE  `conceptnet_assertion` ADD  `img1` INT NOT NULL DEFAULT  '0' AFTER  `ileft2`;
ALTER TABLE  `conceptnet_assertion` ADD  `img2` INT NOT NULL DEFAULT  '0' AFTER  `img1`;
ALTER TABLE  `conceptnet_assertion` ADD  `imgsize1` SMALLINT NOT NULL DEFAULT  '0' AFTER  `best_frame_id`;
ALTER TABLE  `conceptnet_assertion` ADD  `imgsize2` SMALLINT NOT NULL DEFAULT  '0' AFTER  `imgsize1`;
ALTER TABLE  `conceptnet_assertion` ADD  `infos` VARCHAR( 255 ) NOT NULL DEFAULT  '';
ALTER TABLE  `emlog_images` CHANGE  `content`  `content` VARBINARY( 8000 ) NOT NULL;

ALTER TABLE  `jt_concept` DROP  `backimg` ,
DROP  `backheight` ,
DROP  `url` ,
DROP  `num_assertions` ,
DROP  `blogid` ,
DROP  `visible` ,
DROP  `cruboy` ,
DROP  `f1` ,
DROP  `f2` ,

DROP  `uid` ;

ALTER TABLE  `jt_concept` ADD  `imgsize` MEDIUMINT NOT NULL DEFAULT  '0' AFTER  `img`;
ALTER TABLE  `jt_concept` ADD  `info` VARCHAR( 255 ) NOT NULL DEFAULT  '' AFTER  `text`;
ALTER TABLE  `jt_concept` ADD  `sort` TINYINT NOT NULL DEFAULT  '0' AFTER  `words`
ALTER TABLE  `jt_concept` ADD  `birth` DATE NULL DEFAULT NULL;
ALTER TABLE  `jt_concept` ADD  `die`  DATE NULL DEFAULT NULL;
ALTER TABLE  `jt_concept` ADD  `age` VARCHAR( 10 ) NOT NULL DEFAULT  '';
ALTER TABLE  `jt_concept` ADD  `content` text NOT NULL ;

ALTER TABLE  `jt_assertion` DROP  `score` ,
DROP  `abid` ,
DROP  `seq` ,
DROP  `info` ,
DROP  `aurl` ,
DROP  `uid` ;

ALTER TABLE  `jt_assertion` ADD  `itop1` INT NOT NULL DEFAULT  '0' AFTER  `aleft2`
ALTER TABLE  `jt_assertion` ADD  `ileft1` INT NOT NULL DEFAULT  '0' AFTER  `itop1`;
ALTER TABLE  `jt_assertion` ADD  `itop2` INT NOT NULL DEFAULT  '0' AFTER  `ileft1`;
ALTER TABLE  `jt_assertion` ADD  `ileft2` INT NOT NULL DEFAULT  '0' AFTER  `itop2`;
ALTER TABLE  `jt_assertion` ADD  `imgs1` VARCHAR( 200 ) NOT NULL DEFAULT  '' AFTER  `ileft2`
ALTER TABLE  `jt_assertion` ADD  `imgs2` VARCHAR( 200 ) NOT NULL DEFAULT  '' AFTER  `imgs1`
ALTER TABLE  `jt_assertion` ADD  `imgsize1` MEDIUMINT NOT NULL DEFAULT  '0' AFTER  `imgs2`;
ALTER TABLE  `jt_assertion` ADD  `imgsize2` MEDIUMINT NOT NULL DEFAULT  '0' AFTER  `imgsize1`;
ALTER TABLE  `jt_assertion` ADD  `infos` VARCHAR( 500 ) NOT NULL DEFAULT  '' ;

ALTER TABLE  `jt_concept` ADD  `f3` INT NOT NULL DEFAULT  '0' AFTER  `sort`;

UPDATE `jt_concept` A 
INNER JOIN (SELECT  *, COUNT(*) idcount FROM jt_assertion GROUP BY concept1_id) as B
  ON B.concept1_id= A.id
  INNER JOIN (SELECT  *, COUNT(*) idcount2 FROM jt_assertion GROUP BY concept2_id) as C
  ON C.concept2_id= A.id
SET A.f3 = B.idcount+C.idcount2









